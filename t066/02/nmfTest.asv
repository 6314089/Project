% Read audio
[y, fs] = audioread('test10k.wav');
% mono
y = y(:, 1);

% stft
[stfted, f, t] = stft(y, hann(512), 256, fs);
%  ABS and RAD
Y = abs(stfted);
phase = angle(stfted);

%surf(t, f, log(Y), 'edgecolor', 'none');
%axis tight;
%view(0, 90);
%set(gca, 'Yscale', 'log');

% NMF
k = 4;
[W, H] = nnmf(Y, k);

for i = 1:k
    ty = istft(W(:, k) * H(k, :) .* exp(1j * phase), hann(512), 216);
    soundsc(ty
end